Title  : omopaedit version 1.0 簡易マニュアル
Author : pzdc
Date   : 2019, Mar. 29

1.  画面の構成
    
    1.  ヘッダー（画面最上部のテキストエリア）
        
        タイトルを指定する
        テキスト保存や画像保存をする際にここで指定した名称が使用され
        る
        
    
    2.  ツールエリア（画面上部のフォーム）
        
        ツールエリアは基本的な機能を提供する。
        
        新規
            現在盤面の問題と答えのデータを含む編集履歴を破棄する
        
        保存
            現在盤面の問題と答えのデータをファイルに保存する
            保存したファイルは盤面にドラッグすると開く。ドラッグされ
            たファイルと現在開いている画面でパズルの種類が異なる場合
            、現在の画面は破棄され、ドラッグされたファイルを開く。
        
        PNG
            現在の盤面をPNG画像に保存する
        
        解答消去
            答えのデータを破棄する
            履歴は破棄しない
        
        SZ
            リサイズモード
            盤面をドラッグすることで盤面のサイズを変更する
            ドラッグの始点が盤面の右（下）境界線上だった場合、既に入
            力された問題と答えに対して右（下）のマージンを変更する
            そうでない場合は左（上）のマージンを変更する。
            リサイズは履歴を破棄する
        
        QP
            問題の点を編集する（パズル依存）
        
        QC
            問題のマスを編集する（パズル依存）
        
        QW
            問題の線を編集する（パズル依存）
        
        AC
            答えのマスを編集する（パズル依存）
        
        AW
            答えの線を編集する（パズル依存）
        
        [色選択ツール]
            主要な色を選択する（ブラウザ依存）
        
        解答表示
            答えの表示・非表示を切り替える
        
        カーソル表示
            カーソルの表示・非表示を切り替える
        
        透過
            透過処理のON/OFFを切り替える
        
    
    3.  履歴コントローラ（画面左の縦軸とボタン）
        
        履歴コントローラによって編集履歴を閲覧・操作する。
        縦軸上をクリックまたはドラッグで編集履歴を移動する
        上の三角ボタンで元に戻す（アンドゥ）、
        下の三角ボタンで繰り返す（リドゥ）
        
        
    
    4.  盤面（中央の格子領域）
        
        編集を行う盤面を表示する。解答表示がOFFの場合は問題のみの表
        示となることに注意する。
        画像ファイルをドラッグすることで背景画像に設定する。透過をON
        にした場合は盤面を半透明で描画する。
        クリック、ドラッグ、キー入力によって盤面を編集する。具体的な
        編集方法はツールエリアにて指定した編集モードと、個別のパズル
        に依存する。
        
    
    5.  コマンドエリア（画面下部のフォーム）
        
        盤面下部のテキストエリアにコマンドを入力し実行ボタンを押すと
        実行する
        クリアボタンを押すとコマンド実行によって出力したメッセージを
        消去する
        以下にコマンド一覧を示す（随時追加予定、多くなってきたら別セ
        クションに分ける）
        
        help
            ヘルプの出力
        
        check
            正解判定
        
        dup
            現在盤面の複製
        
        consoleclean
            出力コンソールエリアのクリア
        
        debug
            デバッグ（開発者用）
        
        debughist
            履歴をデバッグ（開発者用）
        
    

2.  パズルごとの操作と仕様
    
    6.  ペンシルズ (pencils)
        
        QC
            左クリックで芯または数字をインクリメント
            右クリックで芯または数字のデクリメント
            数字キーで数字の入力
            バックスペースキーで一文字削除
            デリートキーで数字の削除
            ドラッグで芯の入力
            矢印キーで芯の入力
            マイナスキーで？のトグル
            
        
        AC
            左クリックで芯または背景色のインクリメント
            左ドラッグで芯の入力
            矢印キーで芯の入力
            右クリックで背景色の反転
            右ドラッグで背景色の反転(ドラッグの間初期挙動に依存)
            芯のあるマスから右ドラッグで線の入力(ドラッグの間初期挙
            動に依存)
            問題の芯があるマスから左ドラッグで線の入力(ドラッグの間
            初期挙動に依存)
            
        
        AW
            左ドラッグで壁の入力(ドラッグの間初期挙動に依存)
            右ドラッグで線の入力(ドラッグの間初期挙動に依存)
        
        入力制約
            外壁上に壁を描くことを禁止
            問題の芯があるマスに解答の芯を置く操作を禁止
            芯があるマスに色をつける操作を禁止（該当マスはスキップさ
            れる）
            表出数字の上限は(盤面サイズの縦横の大きい辺)-1
        
        正解判定について
            芯から後ろ方向に下がっていき、最初に壁または外壁に衝突す
            るまでをその鉛筆の長さと判定し、その芯から同一長さの線が
            分岐なしに出ているかどうかを検証する。芯の後ろの壁までの
            空間、すなわち「軸」に別の芯があったり線が引かれていたり
            、その空間を他の芯の軸と共有する場合は不正解とする。明示
            的に描かれている芯から出る軸と線によって全ての空間が埋め
            尽くされない場合は不正解とする。
            この正解判定の過程に影響しない余計な線があっても判定に影
            響しない。
        
        ファイル構造
            
            ここでは保存に使用するファイル形式を記述する。以下で与え
            る仕様に従ったファイルであってもパズルとして許容される問
            題・解答とは限らない。フールプルーフを丁寧に行っていない
            ため、保存によって生成されたものでないファイルに関しては
            対応を保証しない。
            
            ファイルは改行文字(\x0a)によってセパレートされたフィール
            ドによって構成される。一行目にファイル形式を記述する。二
            行目にパズルタイプを記述する。三行目以降に盤面情報を記述
            する。盤面情報はさらに複数のフィールドに分けられる。後の
            バージョンでパズルに関するメタ情報を含むフィールド等を追
            加する可能性があるが、この仕様によって明示した範囲に関し
            ては可能な限り後方互換性を保つ。実際の構成を下に示す。
            
                oaef0
                pencils
                [y]
                [x]
                [QC]
                [AC]
                [AW-v]
                [AW-h]
                
            
            フィールド[x]、[y]は盤面サイズを表す整数値を十進数で記述
            する。各フィールドは対応する編集モードによって編集したデ
            ータを格納する。各フィールドのデータは半角スペース文
            字(\x20)と改行文字(\x0a)によってセパレートされたアスキー
            文字列の行列である。フィールドごとの記法は以下に与える。
            記述に際し、シングルクオート文字で囲った文字列は文字列そ
            のまま、ダブルクオートで囲った文字列は正規表現を表してい
            る。ダブルクオート内部ではバックスラッシュで適宜エスケー
            プを行う。
            
        
        フィールド[QC]
            "o[0-9]+" : 数字
            'o' : ？（未知数）
            '1' : 上向き芯
            '2' : 下向き芯
            '3' : 左向き芯
            '4' : 右向き芯
            '.' : オブジェクトなし
            
        
        フィールド[AC]
            '1' : 上向き芯
            '2' : 下向き芯
            '3' : 左向き芯
            '4' : 右向き芯
            '=' : 背景色
            '.' : オブジェクトなし
            
        
        フィールド[AW-v]、[AW-h]
            
            [AW-v]は鉛直方向(y軸方向)の壁、[AW-h]は水平方向(x軸方向)
            の壁を記述する。道の場合は対応する壁を貫くデータを表す。
            '1' : 壁（格子点と格子点をつなぐ線がある状態）
            '-1' : 道（セルの中央と中央をつなぐ線がある状態）
            '0' : オブジェクトなし
            
        
    
    7.  ダブルチョコ (doublechoco)
        
        QC
            左クリックで背景色のトグル
            左ドラッグで背景色の反転(ドラッグの間初期挙動に依存、数
            字もコピーされる)
            右クリックで数字のインクリメント
            数字キーで数字の入力
            バックスペースキーで数字の一文字削除
            デリートキーで数字の削除
            
        
        AW
            左ドラッグで壁の入力(ドラッグの間初期挙動に依存)
            右ドラッグで線の入力(ドラッグの間初期挙動に依存)
        
        入力制約
            外壁上に壁を描くことを禁止
            表出数字の上限は(総面積)/2
        
        正解判定について
            壁によるブロックの仕切り方のみによって正解判定を行う。途
            切れている余分な壁があるかどうかは正解判定に関係しない。
            また壁をつらぬく中線の存在も判定に影響しない。ただし現在
            のバージョンでは壁と中線を同一箇所に配置できないようにし
            ている。
        
        ファイル構造
            
            基本的な文法に関してはペンシルズを参照せよ。
            
                oaef0
                doublechoco
                [y]
                [x]
                [QC]
                [AW-v]
                [AW-h]
                
            
        
        フィールド[QC]
            "c[0-9]+" : 黒マスに数字
            'c' : 黒マス
            ".[0-9]+" : 白マスに数字
            '.' : 白マス
            
        
        フィールド[AW-v]、[AW-h]
            ペンシルズを参照せよ。
        
    
    8.  天体ショー (tentaisho)
        
        QP
            左クリックで星を配置
            右クリックで星を配置(逆順)
        
        AC
            左クリックで背景色のトグル
            左ドラッグで背景色の反転(ドラッグの間初期挙動に依存)
        
        AW
            左ドラッグで壁の入力(ドラッグの間初期挙動に依存)
            右ドラッグで線の入力(ドラッグの間初期挙動に依存)
        
        入力制約
            外壁上に壁を描くことを禁止
        
        正解判定について
            ダブルチョコを参照せよ
        
        ファイル構造
            
            基本的な文法に関してはペンシルズを参照せよ。
            
                oaef0
                tentaisho
                [y]
                [x]
                [QP]
                [AC]
                [AW-v]
                [AW-h]
                
            
        
        フィールド[QP]
            '1' : 白丸
            '2' : 黒丸
            '.' : オブジェクトなし
            
        
        フィールド[AC]
            '=' : 背景色
            '.' : オブジェクトなし
            
        
        フィールド[AW-v]、[AW-h]
            ペンシルズを参照せよ。
        
    
    9.  ミッドループ (midloop)
        
        QP
            左クリックで黒丸を配置
            右クリックで白丸を配置
        
        AW
            左ドラッグで線の入力(ドラッグの間初期挙動に依存)
            右ドラッグで壁の入力(ドラッグの間初期挙動に依存)
        
        入力制約
            外壁上に壁を描くことを禁止
        
        正解判定について
            中線に関して厳密な判定を行う。通過しない黒丸がある場合は
            不正解とする。白丸は正解判定に影響しない。壁は正解判定に
            影響しない。ただし中線と壁についてはダブルチョコを参照せ
            よ
        
        ファイル構造
            
            基本的な文法に関してはペンシルズを参照せよ。
            
                oaef0
                midloop
                [y]
                [x]
                [QP]
                [AW-v]
                [AW-h]
                
            
        
        フィールド[QP]
            '1' : 白丸
            '2' : 黒丸
            '.' : オブジェクトなし
            
        
        フィールド[AW-v]、[AW-h]
            ペンシルズを参照せよ。
        
    
    10. スクリン (squlin)
        
        QC
            左クリックで丸数字を配置
            左ドラッグで表出の移動(入れ替え方式）
            右クリックで丸数字を配置(逆順)
            数字キーで丸数字を入力
            バックスペースキーで丸数字の一文字削除
            デリートキーで丸数字の削除
            マイナスキーで丸のトグル
            
        
        AC
            左クリックで背景色のトグル
            左ドラッグで背景色の反転(ドラッグの間初期挙動に依存)
        
        AW
            左ドラッグで線の入力(ドラッグの間初期挙動に依存)
            右ドラッグで壁の入力(ドラッグの間初期挙動に依存)
        
        入力制約
            表出数字の上限はおよそ総面積と等しい
        
        正解判定について
            ACモードで塗った色のみによって判定を行う。壁と線は正解判
            定に影響しない四角によるループの内側の領域が四角の場合は
            不正解とする。一つの四角に複数の丸が入る場合は不正解とす
            る。
        
        ファイル構造
            
            基本的な文法に関してはペンシルズを参照せよ。
            
                oaef0
                squlin
                [y]
                [x]
                [QC]
                [AC]
                [AW-v]
                [AW-h]
                
            
        
        フィールド[QC]
            '?' : 丸
            "[0-9]+" : 丸数字
            '.' : オブジェクトなし
            
        
        フィールド[AC]
            '=' : 背景色
            '.' : オブジェクトなし
            
        
        フィールド[AW-v]、[AW-h]
            ペンシルズを参照せよ。
        
    

3.  その他の情報
    
    11. キーボードショートカット（パズルに依らない操作）
        
        F2
            ヘッダーにフォーカス
        
        Ctrl+Enter
            コマンドエリアにフォーカス（コマンドエリアにフォーカスが
            ない場合）
        
        Ctrl+Enter
            コマンドを実行（コマンドエリアにフォーカスがある場合）
        
        ESC
            任意のフォームからフォーカスを外す
        
        Ctrl+左右キー
            モードを変更（SZモード以外からSZモードになることはない）
        
    
    12. Tips
        盤面のキー入力編集は最後に盤面にあったカーソルの位置（カーソ
        ル表示をONにした場合の表示位置）に対して適用される
    


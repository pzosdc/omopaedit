&& Language    : RDL
&& Description : omopaedit manual
&& Maintainer  : pzdc
&& Lastchange  : 2019, Mar. 29

&(; title  &|; omopaedit&;version&; 1.0 &;簡易マニュアル &);
&(; author &|; pzdc &);
&(; date   &|; 2019,&;Mar.&;29 &);
&maketitle;

&(C;
  画面の構成
&|C;
&(S;
  ヘッダー（画面最上部のテキストエリア）
&|S;
  &(P;
  タイトルを指定する&n;
  テキスト保存や画像保存をする際にここで指定した名称が使用される
  &)P;
&)S;

&(S;
  ツールエリア（画面上部のフォーム）
&|S;
  &(P;
  ツールエリアは基本的な機能を提供する。
  &)P;
  &(L;新規            &|L;現在盤面の問題と答えのデータを含む編集履歴を破棄する&)L;
  &(L;保存            &|L;現在盤面の問題と答えのデータをファイルに保存する&n;
                          保存したファイルは盤面にドラッグすると開く。
                          ドラッグされたファイルと現在開いている画面でパズルの種類が異なる場合、
                          現在の画面は破棄され、ドラッグされたファイルを開く。&)L;
  &(L;PNG             &|L;現在の盤面をPNG画像に保存する&)L;
  &(L;解答消去        &|L;答えのデータを破棄する&n;
                          履歴は破棄しない&)L;
  &(L;SZ              &|L;リサイズモード&n;
                          盤面をドラッグすることで盤面のサイズを変更する&n;
                          ドラッグの始点が盤面の右（下）境界線上だった場合、
                          既に入力された問題と答えに対して右（下）のマージンを変更する&n;
                          そうでない場合は左（上）のマージンを変更する。&n;
                          リサイズは履歴を破棄する
                          &)L;
  &(L;QP              &|L;問題の点を編集する（パズル依存） &)L;
  &(L;QC              &|L;問題のマスを編集する（パズル依存） &)L;
  &(L;QW              &|L;問題の線を編集する（パズル依存） &)L;
  &(L;AC              &|L;答えのマスを編集する（パズル依存） &)L;
  &(L;AW              &|L;答えの線を編集する（パズル依存） &)L;
  &(L;[色選択ツール]  &|L;主要な色を選択する（ブラウザ依存） &)L;
  &(L;解答表示        &|L;答えの表示・非表示を切り替える &)L;
  &(L;カーソル表示    &|L;カーソルの表示・非表示を切り替える &)L;
  &(L;透過            &|L;透過処理のON/OFFを切り替える &)L;
&)S;

&(S;
  履歴コントローラ（画面左の縦軸とボタン）
&|S;
  &(P;
  &+n;履歴コントローラによって編集履歴を閲覧・操作する。
  縦軸上をクリックまたはドラッグで編集履歴を移動する
  上の三角ボタンで元に戻す（アンドゥ）、
  下の三角ボタンで繰り返す（リドゥ）
  &-n;
  &)P;
&)S;

&(S;
  盤面（中央の格子領域）
&|S;
  &(P;
  編集を行う盤面を表示する。解答表示がOFFの場合は問題のみの表示となることに注意する。&n;
  画像ファイルをドラッグすることで背景画像に設定する。透過をONにした場合は盤面を半透明で描画する。&n;
  クリック、ドラッグ、キー入力によって盤面を編集する。具体的な編集方法はツールエリアにて指定した編集モードと、
  個別のパズルに依存する。
  &)P;
&)S;

&(S;
  コマンドエリア（画面下部のフォーム）
&|S;
  &(P;
    盤面下部のテキストエリアにコマンドを入力し実行ボタンを押すと実行する&n;
    クリアボタンを押すとコマンド実行によって出力したメッセージを消去する&n;
    以下にコマンド一覧を示す（随時追加予定、多くなってきたら別セクションに分ける）
  &)P;
  &(L; &fI;help&fO; &|L; ヘルプの出力 &)L;
  &(L; &fI;check&fO; &|L; 正解判定 &)L;
  &(L; &fI;dup&fO; &|L; 現在盤面の複製 &)L;
  &(L; &fI;consoleclean&fO; &|L; 出力コンソールエリアのクリア &)L;
  &(L; &fI;debug&fO; &|L; デバッグ（開発者用） &)L;
  &(L; &fI;debughist&fO; &|L; 履歴をデバッグ（開発者用） &)L;
&)S;

&)C;

&(C;
  パズルごとの操作と仕様
&|C;
&(S;
  ペンシルズ&;(pencils)
&|S;
  &(L; QC &|L;
    &+n;左クリックで芯または数字をインクリメント
    右クリックで芯または数字のデクリメント
    数字キーで数字の入力
    バックスペースキーで一文字削除
    デリートキーで数字の削除
    ドラッグで芯の入力
    矢印キーで芯の入力
    マイナスキーで？のトグル
    &-n;
  &)L;
  &(L; AC &|L;
    &+n;左クリックで芯または背景色のインクリメント
    左ドラッグで芯の入力
    矢印キーで芯の入力
    右クリックで背景色の反転
    右ドラッグで背景色の反転(ドラッグの間初期挙動に依存)
    芯のあるマスから右ドラッグで線の入力(ドラッグの間初期挙動に依存)
    問題の芯があるマスから左ドラッグで線の入力(ドラッグの間初期挙動に依存)
    &-n;
  &)L;
  &(L; AW &|L;
    左ドラッグで壁の入力(ドラッグの間初期挙動に依存)&n;
    右ドラッグで線の入力(ドラッグの間初期挙動に依存)
  &)L;
  &(L; 入力制約 &|L;
    外壁上に壁を描くことを禁止&n;
    問題の芯があるマスに解答の芯を置く操作を禁止&n;
    芯があるマスに色をつける操作を禁止（該当マスはスキップされる）&n;
    表出数字の上限は(盤面サイズの縦横の大きい辺)-1
  &)L;
  &(L; 正解判定について &|L;
    芯から後ろ方向に下がっていき、最初に壁または外壁に衝突するまでをその鉛筆の長さと判定し、
    その芯から同一長さの線が分岐なしに出ているかどうかを検証する。
    芯の後ろの壁までの空間、すなわち「軸」に別の芯があったり線が引かれていたり、
    その空間を他の芯の軸と共有する場合は不正解とする。
    明示的に描かれている芯から出る軸と線によって全ての空間が埋め尽くされない場合は不正解とする。&n;
    この正解判定の過程に影響しない余計な線があっても判定に影響しない。
  &)L;
  &(L; ファイル構造 &|L;
    &(P;
    ここでは保存に使用するファイル形式を記述する。
    以下で与える仕様に従ったファイルであってもパズルとして許容される問題・解答とは限らない。
    フールプルーフを丁寧に行っていないため、保存によって生成されたものでないファイルに関しては対応を保証しない。
    &)P;
    &(P;
    ファイルは改行文字(\x0a)によってセパレートされたフィールドによって構成される。
    一行目にファイル形式を記述する。
    二行目にパズルタイプを記述する。
    三行目以降に盤面情報を記述する。盤面情報はさらに複数のフィールドに分けられる。
    後のバージョンでパズルに関するメタ情報を含むフィールド等を追加する可能性があるが、
    この仕様によって明示した範囲に関しては可能な限り後方互換性を保つ。
    実際の構成を下に示す。
    &)P;
    &(D;
    &+n;oaef0
    pencils
    [y]
    [x]
    [QC]
    [AC]
    [AW-v]
    [AW-h]
    &-n;
    &)D;
    &(P;
    フィールド[x]、[y]は盤面サイズを表す整数値を十進数で記述する。
    各フィールドは対応する編集モードによって編集したデータを格納する。
    各フィールドのデータは半角スペース文字(\x20)と改行文字(\x0a)によってセパレートされたアスキー文字列の行列である。
    フィールドごとの記法は以下に与える。&n;
    記述に際し、シングルクオート文字で囲った文字列は文字列そのまま、ダブルクオートで囲った文字列は正規表現を表している。
    ダブルクオート内部ではバックスラッシュで適宜エスケープを行う。
    &)P;
  &)L;
  &(L; フィールド[QC] &|L;
    &+n;"o[0-9]+" &; : &; 数字
    'o' &; : &; ？（未知数）
    '1' &; : &; 上向き芯
    '2' &; : &; 下向き芯
    '3' &; : &; 左向き芯
    '4' &; : &; 右向き芯
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AC] &|L;
    &+n;'1' &; : &; 上向き芯
    '2' &; : &; 下向き芯
    '3' &; : &; 左向き芯
    '4' &; : &; 右向き芯
    '=' &; : &; 背景色
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AW-v]、[AW-h] &|L;
    &(P;
    [AW-v]は鉛直方向(y軸方向)の壁、[AW-h]は水平方向(x軸方向)の壁を記述する。道の場合は対応する壁を貫くデータを表す。
    &)P;
    &+n;'1' &; : &; 壁（格子点と格子点をつなぐ線がある状態）
    '-1' &; : &; 道（セルの中央と中央をつなぐ線がある状態）
    '0' &; : &; オブジェクトなし
    &-n;
  &)L;
&)S;

&(S;
  ダブルチョコ&;(doublechoco)
&|S;
  &(L; QC &|L;
    &+n;左クリックで背景色のトグル
    左ドラッグで背景色の反転(ドラッグの間初期挙動に依存、数字もコピーされる)
    右クリックで数字のインクリメント
    数字キーで数字の入力
    バックスペースキーで数字の一文字削除
    デリートキーで数字の削除
    &-n;
  &)L;
  &(L; AW &|L;
    左ドラッグで壁の入力(ドラッグの間初期挙動に依存)&n;
    右ドラッグで線の入力(ドラッグの間初期挙動に依存)
  &)L;
  &(L; 入力制約 &|L;
    外壁上に壁を描くことを禁止&n;
    表出数字の上限は(総面積)/2
  &)L;
  &(L; 正解判定について &|L;
    壁によるブロックの仕切り方のみによって正解判定を行う。
    途切れている余分な壁があるかどうかは正解判定に関係しない。
    また壁をつらぬく中線の存在も判定に影響しない。
    ただし現在のバージョンでは壁と中線を同一箇所に配置できないようにしている。
  &)L;
  &(L; ファイル構造 &|L;
    &(P;
      基本的な文法に関してはペンシルズを参照せよ。
    &)P;
    &(D;
    &+n;oaef0
    doublechoco
    [y]
    [x]
    [QC]
    [AW-v]
    [AW-h]
    &-n;
    &)D;
  &)L;
  &(L; フィールド[QC] &|L;
    &+n;"c[0-9]+" &; : &; 黒マスに数字
    'c' &; : &; 黒マス
    ".[0-9]+" &; : &; 白マスに数字
    '.' &; : &; 白マス
    &-n;
  &)L;
  &(L; フィールド[AW-v]、[AW-h] &|L;
    ペンシルズを参照せよ。
  &)L;
&)S;

&(S;
  天体ショー&;(tentaisho)
&|S;
  &(L; QP &|L;
    左クリックで星を配置&n;
    右クリックで星を配置(逆順)
  &)L;
  &(L; AC &|L;
    左クリックで背景色のトグル&n;
    左ドラッグで背景色の反転(ドラッグの間初期挙動に依存)
  &)L;
  &(L; AW &|L;
    左ドラッグで壁の入力(ドラッグの間初期挙動に依存)&n;
    右ドラッグで線の入力(ドラッグの間初期挙動に依存)
  &)L;
  &(L; 入力制約 &|L;
    外壁上に壁を描くことを禁止
  &)L;
  &(L; 正解判定について &|L;
    ダブルチョコを参照せよ
  &)L;
  &(L; ファイル構造 &|L;
    &(P;
      基本的な文法に関してはペンシルズを参照せよ。
    &)P;
    &(D;
    &+n;oaef0
    tentaisho
    [y]
    [x]
    [QP]
    [AC]
    [AW-v]
    [AW-h]
    &-n;
    &)D;
  &)L;
  &(L; フィールド[QP] &|L;
    &+n;'1' &; : &; 白丸
    '2' &; : &; 黒丸
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AC] &|L;
    &+n;'=' &; : &; 背景色
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AW-v]、[AW-h] &|L;
    ペンシルズを参照せよ。
  &)L;
&)S;

&(S;
  ミッドループ&;(midloop)
&|S;
  &(L; QP &|L;
    左クリックで黒丸を配置&n;
    右クリックで白丸を配置
  &)L;
  &(L; AW &|L;
    左ドラッグで線の入力(ドラッグの間初期挙動に依存)&n;
    右ドラッグで壁の入力(ドラッグの間初期挙動に依存)
  &)L;
  &(L; 入力制約 &|L;
    外壁上に壁を描くことを禁止
  &)L;
  &(L; 正解判定について &|L;
    中線に関して厳密な判定を行う。通過しない黒丸がある場合は不正解とする。
    白丸は正解判定に影響しない。壁は正解判定に影響しない。
    ただし中線と壁についてはダブルチョコを参照せよ
  &)L;
  &(L; ファイル構造 &|L;
    &(P;
      基本的な文法に関してはペンシルズを参照せよ。
    &)P;
    &(D;
    &+n;oaef0
    midloop
    [y]
    [x]
    [QP]
    [AW-v]
    [AW-h]
    &-n;
    &)D;
  &)L;
  &(L; フィールド[QP] &|L;
    &+n;'1' &; : &; 白丸
    '2' &; : &; 黒丸
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AW-v]、[AW-h] &|L;
    ペンシルズを参照せよ。
  &)L;
&)S;

&(S;
  スクリン&;(squlin)
&|S;
  &(L; QC &|L;
    &+n;左クリックで丸数字を配置
    左ドラッグで表出の移動(入れ替え方式）
    右クリックで丸数字を配置(逆順)
    数字キーで丸数字を入力
    バックスペースキーで丸数字の一文字削除
    デリートキーで丸数字の削除
    マイナスキーで丸のトグル
    &-n;
  &)L;
  &(L; AC &|L;
    左クリックで背景色のトグル&n;
    左ドラッグで背景色の反転(ドラッグの間初期挙動に依存)
  &)L;
  &(L; AW &|L;
    左ドラッグで線の入力(ドラッグの間初期挙動に依存)&n;
    右ドラッグで壁の入力(ドラッグの間初期挙動に依存)
  &)L;
  &(L; 入力制約 &|L;
    表出数字の上限はおよそ総面積と等しい
  &)L;
  &(L; 正解判定について &|L;
    ACモードで塗った色のみによって判定を行う。壁と線は正解判定に影響しない
    四角によるループの内側の領域が四角の場合は不正解とする。
    一つの四角に複数の丸が入る場合は不正解とする。
  &)L;
  &(L; ファイル構造 &|L;
    &(P;
      基本的な文法に関してはペンシルズを参照せよ。
    &)P;
    &(D;
    &+n;oaef0
    squlin
    [y]
    [x]
    [QC]
    [AC]
    [AW-v]
    [AW-h]
    &-n;
    &)D;
  &)L;
  &(L; フィールド[QC] &|L;
    &+n;'?' &; : &; 丸
    "[0-9]+" &; : &; 丸数字
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AC] &|L;
    &+n;'=' &; : &; 背景色
    '.' &; : &; オブジェクトなし
    &-n;
  &)L;
  &(L; フィールド[AW-v]、[AW-h] &|L;
    ペンシルズを参照せよ。
  &)L;
&)S;

&)C;

&(C;
  その他の情報
&|C;
&(S;
  キーボードショートカット（パズルに依らない操作）
&|S;
&(L;F2            &|L; ヘッダーにフォーカス&)L;
&(L;Ctrl+Enter    &|L; コマンドエリアにフォーカス（コマンドエリアにフォーカスがない場合）&)L;
&(L;Ctrl+Enter    &|L; コマンドを実行（コマンドエリアにフォーカスがある場合）&)L;
&(L;ESC           &|L; 任意のフォームからフォーカスを外す&)L;
&(L;Ctrl+左右キー &|L; モードを変更（SZモード以外からSZモードになることはない）&)L;
&)S;

&(S;
  Tips
&|S;
  盤面のキー入力編集は最後に盤面にあったカーソルの位置（カーソル表示をONにした場合の表示位置）に対して適用される
&)S;

&)C;
